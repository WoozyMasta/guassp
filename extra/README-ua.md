<!-- omit in toc -->
# Guassp - GitLab User Access Synchronizer for SonarQube Projects

**Guassp** ‚Äî
**–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ç–æ—Ä –¥–æ—Å—Ç—É–ø—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ GitLab –¥–ª—è –ø—Ä–æ–µ–∫—Ç—ñ–≤ SonarQube**

–ü—Ä–æ–µ–∫—Ç –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–æ—ó –Ω–∞ –±–∞–≥–∞—Ç–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
—ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó [SonarQube][] —Ç–∞ [GitLab][]. –ë–∞—á–∏–º—ñ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç—É —Ç–∞ –¥–æ–∑–≤–æ–ª–∏
–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –±—É–¥—É—Ç—å –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ –≤ SonarQube —Ç–∞–∫–∏–º –∂–µ —á–∏–Ω–æ–º, —è–∫ –¥–æ–∑–≤–æ–ª–∏
–¥–ª—è –ø—Ä–æ–µ–∫—Ç—É –≤ GitLab.

> –¶–µ–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–æ—Å—Ç—É–ø–Ω–∏–π –º–æ–≤–∞–º–∏: [eng üá¨üáß][], [ua üá∫üá¶][], [rus üá∑üá∫][]

* [–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è](#—Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è)
* [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏)
* [–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤](#–∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤)
* [–®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç](#—à–≤–∏–¥–∫–∏–π-—Å—Ç–∞—Ä—Ç)
* [–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è](#–∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è)
* [API](#api)
* [–ü–∞–π–ø–ª–∞–π–Ω](#–ø–∞–π–ø–ª–∞–π–Ω)
* [–ú–µ—Ç—Ä–∏–∫–∏](#–º–µ—Ç—Ä–∏–∫–∏)
* [–°–∫–ª–∞–¥–∞–Ω–Ω—è —Ç–∞ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ–µ–∫—Ç—É](#—Å–∫–ª–∞–¥–∞–Ω–Ω—è-—Ç–∞-–Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è-–ø—Ä–æ–µ–∫—Ç—É)

## –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è

–¶–µ–π –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ **API** —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É, —è–∫–∏–π –ø—Ä–∏–π–º–∞—î –∑–∞–ø–∏—Ç–∏ –Ω–∞
–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–æ–∑–≤–æ–ª—ñ–≤ –∑ –∫–æ–Ω–≤–µ—î—Ä–∞ GitLab CI, –¥–µ –≤—Å—è –¥–æ–≤—ñ—Ä–∞ [–ø–æ–±—É–¥–æ–≤–∞–Ω–∞
–Ω–∞–≤–∫–æ–ª–æ][jt] `CI_JOB_TOKEN`, –¥–æ–≤—ñ—Ä–µ–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è –¥–æ–¥–∞—é—Ç—å—Å—è –¥–æ —á–µ—Ä–≥–∏
–∑–∞–≤–¥–∞–Ω—å RQ (Redis Queue). –ó–∞–≤–¥–∞–Ω–Ω—è –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è –±–µ–∫–µ–Ω–¥-–≤–æ—Ä–∫–µ—Ä–∞–º–∏ Worker,
–∞ –¥–ª—è –≤–∏–≤–µ–¥–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –æ–∫—Ä–µ–º–∏–π –µ–∫—Å–ø–æ—Ä—Ç–µ—Ä –º–µ—Ç—Ä–∏–∫
prometheus.

![scheme][]

–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –≤–∏–¥–∞—é—Ç—å—Å—è –∑–∞ —Ä—ñ–≤–Ω–µ–º –¥–æ—Å—Ç—É–ø—É —Ä–æ–ª–µ–π SonarQube –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ
–Ω–∞—è–≤–Ω–∏—Ö –¥–æ–∑–≤–æ–ª—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –ø—Ä–æ–µ–∫—Ç—É –≤ GitLab.  
–í—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è —Ç–µ, —è–∫ GitLab —Ä–µ–∞–ª—ñ–∑—É—î –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É
–ø—Ä–æ–µ–∫—Ç—ñ, —Ç–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —ñ–∑ –∑–∞–ø—Ä–æ—à–µ–Ω–∏—Ö –≥—Ä—É–ø, –¥–µ —Ä—ñ–≤–Ω—ñ –¥–æ—Å—Ç—É–ø—É —ñ–º—ñ—Ç—É—é—Ç—å—Å—è
–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ GitLab.

![permissions][]  
![role-mapping][]

* [–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è](#—Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è)
* [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏)
* [–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤](#–∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤)
* [–®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç](#—à–≤–∏–¥–∫–∏–π-—Å—Ç–∞—Ä—Ç)
* [–ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è](#–∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è)
* [API](#api)
* [–ü–∞–π–ø–ª–∞–π–Ω](#–ø–∞–π–ø–ª–∞–π–Ω)
* [–ú–µ—Ç—Ä–∏–∫–∏](#–º–µ—Ç—Ä–∏–∫–∏)
* [–°–∫–ª–∞–¥–∞–Ω–Ω—è —Ç–∞ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ–µ–∫—Ç—É](#—Å–∫–ª–∞–¥–∞–Ω–Ω—è-—Ç–∞-–Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è-–ø—Ä–æ–µ–∫—Ç—É)

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –Ω–∞ [flask][], –¥–ª—è WSGI –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–∏–π [bjoern][],
—Ä–æ–±–æ—Ç–∞ –∑ API GitLab –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ [python-gitlab][], –∞ SonarQube
API —á–µ—Ä–µ–∑ [python-sonarqube-api][]. –î–ª—è –æ–±—Ä–æ–±–∫–∏ —á–µ—Ä–≥–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è [RQ][rq], —á–∏—ó –º–µ—Ç—Ä–∏–∫–∏ –≤—ñ–¥–¥–∞—î [rq-exporter][].

## –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤

–í–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑ —Ä–µ–≥—ñ—Å—Ç—Ä—ñ–≤:

* [`ghcr.io/woozymasta/guassp:latest`][ghcr]
* [`quay.io/woozymasta/guassp:latest`][quay]
* [`docker.io/woozymasta/guassp:latest`][dhub]

## –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

–î–ª—è —à–≤–∏–¥–∫–æ–≥–æ —Å—Ç–∞—Ä—Ç—É –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥ —ñ–∑ [docker-compose][]:

1. [docker-compose.env][] - –∑–º—ñ–Ω—ñ—Ç—å –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —É —Ñ–∞–π–ª—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –æ—Ç–æ—á–µ–Ω–Ω—è
2. [docker-compose.yml][] - –≤–∏–∫–æ–Ω–∞–π—Ç–µ `docker-compose up -d`

## –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

–©–æ–± –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –ø–æ—Ç—Ä—ñ–±–Ω—É —É—Ç–∏–ª—ñ—Ç—É, –ø–µ—Ä–µ–¥–∞–π—Ç–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∞–±–æ —Å—Ü–µ–Ω–∞—Ä—ñ–π
`guassp.sh` –∞—Ä–≥—É–º–µ–Ω—Ç:

* `worker` _(–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º)_ - –ø—Ä–æ—Ü–µ—Å–æ—Ä –∑–∞–≤–¥–∞–Ω—å –¥–ª—è —á–µ—Ä–≥–∏;
* `api` - API –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é –∑–∞–≤–¥–∞–Ω—å;
* `exporter` - prometheus –º–µ—Ç—Ä–∏–∫–∏;
* `all-in-one` - –∑–∞–ø—É—Å–∫ `worker`, `api` —Ç–∞ `exporter` –æ–¥—Ä–∞–∑—É;
* `API -DEV` - –∑–∞–ø—É—Å–∫ API —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä Flask Dev.

### –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É

* **`LISTEN_ADDRESS`**=`0.0.0.0` - –•–æ—Å—Ç –¥–ª—è –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó API;
* **`LISTEN_PORT`**=`5000` - –ü–æ—Ä—Ç –¥–ª—è –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó API;
* **`LOG_LEVEL`**=`INFO` - –†—ñ–≤–µ–Ω—å –ª–æ–≥—É–≤–∞–Ω–Ω—è;
* **`SECRET_KEY`**=`secret` - –°–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–ª—é—á;
* **`QUEUE_RESULT_TTL`**=`7200` - –ß–∞—Å –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —á–µ—Ä–≥–∏;
* **`MORE_ACCURATE_SYNC`**=`true` - –ü–æ—à—É–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —É SonarQube
  –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ—é –ø–æ—à—Ç–æ—é GitLab, —ñ–Ω–∞–∫—à–µ –ø–æ—à—É–∫ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –Ω–∞ —ñ–º'—è
  –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. –¶–µ –≤–∏–∫–ª–∏–∫–∞—î —â–µ –æ–¥–∏–Ω –∑–∞–ø–∏—Ç API –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —Ü–µ
  –±—ñ–ª—å—à —Ç–æ—á–Ω–æ, –∞–ª–µ –ø–æ–≤—ñ–ª—å–Ω—ñ—à–µ –≤–¥–≤—ñ—á—ñ.

### –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ä–æ–±–æ—Ç–∏ –∑ GitLab

* **`GITLAB_URL`**=`https://gitlab.com` - –ê–¥—Ä–µ—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞ GitLab;
* **`GITLAB_TOKEN`** - –¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø—É –¥–æ GitLab, –ø–æ–≤–∏–Ω–µ–Ω –º–∞—Ç–∏ –ø—Ä–∞–≤–∞ –Ω–∞
  –ø–µ—Ä–µ–≥–ª—è–¥ —É—á–∞—Å–Ω–∏–∫—ñ–≤ —Ç–∞ —ó—Ö –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É –¥–ª—è –ø—Ä–æ–µ–∫—Ç—ñ–≤, —â–æ –æ–±—Å–ª—É–≥–æ–≤—É—é—Ç—å—Å—è;
* **`GITLAB_SKIP_USERS`** - –°–ø–∏—Å–æ–∫ (—Ä–æ–∑–¥—ñ–ª–µ–Ω–∏—Ö –∫–æ–º–æ—é) ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤,
  —è–∫—ñ –±—É–¥—É—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω—ñ –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó.

### –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ä–æ–±–æ—Ç–∏ –∑ SonarQube

* **`SONARQUBE_URL`** - –ê–¥—Ä–µ—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞ SonarQube;
* **`SONARQUBE_TOKEN`** - –¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø—É –¥–æ SonarQube –∑ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏–º–∏
  –ø—Ä–∏–≤—ñ–ª–µ—è–º–∏;
* **`SONARQUBE_ALM_KEY`** - –ö–ª—é—á [ALM][] (–Ω–∞–∑–≤–∞) —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –∑ GitLab;
* **`SONARQUBE_SKIP_GROUPS`** - –°–ø–∏—Å–æ–∫ (—Ä–æ–∑–¥—ñ–ª–µ–Ω–∏—Ö –∫–æ–º–æ—é) –≥—Ä—É–ø,
  —è–∫—ñ –±—É–¥—É—Ç—å –ø—Ä–æ—ñ–≥–Ω–æ—Ä–æ–≤–∞–Ω—ñ –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó.

### –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ä–æ–±–æ—Ç–∏ –∑ Redis

* **`REDIS_URL`**=`redis://localhost:6379/0` - URL-–∞–¥—Ä–µ—Å–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ
  —Å–µ—Ä–≤–µ—Ä–∞ Redis.

### –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –µ–∫—Å–ø–æ—Ä—Ç–µ—Ä–∞ –º–µ—Ç—Ä–∏–∫ Prometheus

* **`EXPORTER_LISTEN_ADDRESS`**=`0.0.0.0` - –•–æ—Å—Ç –¥–ª—è –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó
  Prometeus –º–µ—Ç—Ä–∏–∫;
* **`EXPORTER_LISTEN_PORT`**=`9726` - –ü–æ—Ä—Ç –¥–ª—è –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó Prometeus –º–µ—Ç—Ä–∏–∫.

## API

### –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –∑–∞–≤–¥–∞–Ω–Ω—è

> POST **`/task`**
>
> ```json
> {"job_token": str}
> ```
>
> Headers: `JOB-TOKEN` or `Authorization: Bearer`

–ü–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç–∏ —Ç–æ–∫–µ–Ω –∑–∞–≤–¥–∞–Ω–Ω—è —É –±—É–¥—å-—è–∫–æ–º—É –∑ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤:

```bash
curl -sL http://127.0.0.1:5000/task \
  -H "Content-Type: application/json" \
  -d '{"job_token": "'$CI_JOB_TOKEN'"}' | jq

curl -sL http://127.0.0.1:5000/task -X POST \
  -H "JOB-TOKEN: $CI_JOB_TOKEN" | jq

curl -sL http://127.0.0.1:5000/task -X POST \
  -H "Authorization: Bearer $CI_JOB_TOKEN" | jq
```

–¢–æ–∫–µ–Ω –∑–∞–≤–¥–∞–Ω–Ω—è –º–æ–∂–µ –±—É—Ç–∏ –ø–µ—Ä–µ–¥–∞–Ω–∏–π –∑–∞–≥–æ–ª–æ–≤–∫–æ–º `JOB-TOKEN` –∞–±–æ
`Authorization: Bearer` –∞–±–æ –±—É—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º –∫–ª—é—á–∞ `job_token` —É JSON

### –ß–µ—Ä–≥–∞ –∑–∞–≤–¥–∞–Ω—å

> GET **`/tasks`**

```bash
curl -sL http://127.0.0.1:5000/tasks | jq
curl -sL http://127.0.0.1:5000/tasks | jq -er '.tasks | keys'
```

### –°—Ç–∞—Ç—É—Å –∑–∞–≤–¥–∞–Ω–Ω—è

> GET **`/task/<job_uuid>`**

```bash
curl -sL http://127.0.0.1:5000/task/8b155172-cfcf-4777-b9f4-bfce53b6eb0e | jq
```

### –í–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è –∑ —á–µ—Ä–≥–∏

> DELETE **`/task/<job_uuid>`**

```bash
curl -sL http://127.0.0.1:5000/task/8b155172-cfcf-4777-b9f4-bfce53b6eb0e \
  -X DELETE | jq
```

## –ü–∞–π–ø–ª–∞–π–Ω

–£ –ø–∞–π–ø–ª–∞–π–Ω—ñ GitLab CI –≤ –ø–µ—Ä—à—É —á–µ—Ä–≥—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ
–Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è [ALM][] –∑—Ä–æ–±–ª–µ–Ω–æ —Ç–∞ –≤—ñ–¥–Ω–æ—Å–∏—Ç—å—Å—è –¥–æ –≤–∞—à–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É, –ø—ñ—Å–ª—è
—á–æ–≥–æ –º–æ–∂–Ω–∞ –Ω–∞–¥—Å–∏–ª–∞—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é –≤ guassp. –û—Å—å —Ç–µ–ø–µ—Ä –º–æ–∂–Ω–∞
—Ä–æ–∑–ø–æ—á–∏–Ω–∞—Ç–∏ –∞–Ω–∞–ª—ñ–∑ –ø—Ä–æ–µ–∫—Ç—É.

–î–ª—è –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó API Guassp –∑–∞ Nginx —è–∫ —á–∞—Å—Ç–∏–Ω–∏ API SonarQube, –¥–∏–≤—ñ—Ç—å—Å—è –¥–æ
[–ø—Ä–∏–∫–ª–∞–¥—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó Nginx][]

```bash
: "${SONARQUBE_PROJECT_KEY:=gitlab:$CI_PROJECT_ID}"

curl --location --fail --user "$SONARQUBE_TOKEN:" \
  "$SONARQUBE_URL/api/alm_settings/set_gitlab_binding" \
  -d "almSetting=$SONARQUBE_ALM_NAME" \
  -d "project=$SONARQUBE_PROJECT_KEY" \
  -d "repository=$CI_PROJECT_ID"

curl --location --fail -X POST -H "JOB-TOKEN: $CI_JOB_TOKEN" \
  "$SONARQUBE_URL/api/guassp/task"
```

–ë—ñ–ª—å—à –æ–±'—î–º–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥ —Å–∫—Ä–∏–ø—Ç—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è SonarQube —É –ø–∞–π–ø–ª–∞–π–Ω—ñ –≤–∏ –º–æ–∂–µ—Ç–µ
–ø–æ–±–∞—á–∏—Ç–∏ —É —Ñ–∞–π–ª—ñ
[`sq-integration-taks.sh`][sq-integration-taks]

## –ú–µ—Ç—Ä–∏–∫–∏

–ú–µ—Ç—Ä–∏–∫–∏ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø—Ä–æ–µ–∫—Ç—É [rq-exporter]

Dashboard ID `12196` –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—ó –≤ Grafana –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ
–π–æ–≥–æ [–∞–¥–∞–ø—Ç–∞—Ü—ñ—é][dashboard], —è–∫–∏–π –≤–∏–≤–æ–¥–∏—Ç–∏–º–µ –ª–∏—à–µ –º–µ—Ç—Ä–∏–∫–∏ –∑ guassp.

## –°–∫–ª–∞–¥–∞–Ω–Ω—è —Ç–∞ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ–µ–∫—Ç—É

–ù–∞–±—ñ—Ä –∫–æ–º–∞–Ω–¥ –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è

```bash
# Build
podman build -t guassp .

# Redis
podman run --rm -d -p 6379:6379 --name redis redis
# API
podman run --rm -d -p 5000:5000 --env-file .env --name guassp-api localhost/guassp:latest api
# Workers
podman run --rm -d --env-file .env --name guassp-worker-1 localhost/guassp:latest worker
podman run --rm -d --env-file .env --name guassp-worker-2 localhost/guassp:latest worker
# Exporter
podman run --rm -d -p 9726:9726 --env-file .env --name guassp-exporter localhost/guassp:latest exporter

# Check
curl 0.0.0.0:9726 -s | grep -v '^#'
curl 0.0.0.0:5000/tasks -s | jq
curl 0.0.0.0:5000/task -s -X POST -H "JOB-TOKEN: $CI_JOB_TOKEN" | jq
```

–ê–±–æ –∑–∞–ø—É—Å—Ç–∏–º–æ –ª–æ–∫–∞–ª—å–Ω–æ, –¥–ª—è —Ü—å–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

```bash
apt-get install -y libev-dev libevdev2
python -m venv .venv
./.venv/bin/activate
pip install requirements.txt
```

–ê–±–æ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –∑–∞—Å—Ç–æ—Å—É–Ω–∫–∏ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç `guassp`

```bash
./guassp.sh api
./guassp.sh worker
./guassp.sh exporter
```

<!-- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –¥–æ —Ñ–∞–π–ª—ñ–≤ -->
[eng üá¨üáß]: ../README.md
[ua üá∫üá¶]: README-ua.md
[rus üá∑üá∫]: README-ru.md
[scheme]: scheme.drawio.png
[permissions]: permissions.drawio.png
[role-mapping]: role-mapping.png
[dashboard]: grafana-dashboard.json
[docker-compose.env]: docker-compose.env
[docker-compose.yml]: docker-compose.yml
[–ø—Ä–∏–∫–ª–∞–¥—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó Nginx]: nginx.conf
[sq-integration-taks]: sq-integration-taks.sh

<!-- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –¥–æ —Å—Ç–æ—Ä—ñ–Ω–æ–∫ -->
[GitLab]: https://about.gitlab.com
[SonarQube]: https://www.sonarqube.org
[ALM]: https://docs.sonarqube.org/latest/analysis/gitlab-integration/#header-5
[jt]: https://docs.gitlab.com/ee/api/jobs.html#get-job-tokens-job
[flask]: https://github.com/pallets/flask
[bjoern]: https://github.com/jonashaag/bjoern
[python-gitlab]: https://github.com/python-gitlab/python-gitlab
[python-sonarqube-api]: https://github.com/shijl0925/python-sonarqube-api
[rq]: https://github.com/rq/rq
[rq-exporter]: https://github.com/mdawar/rq-exporter
[docker-compose]: https://docs.docker.com/compose/

<!-- Containers -->
[quay]: https://quay.io/repository/woozymasta/guassp
[dhub]: https://hub.docker.com/r/woozymasta/guassp
[ghcr]: https://github.com/WoozyMasta/guassp/pkgs/container/guassp
